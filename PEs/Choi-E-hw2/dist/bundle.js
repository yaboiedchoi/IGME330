(()=>{"use strict";var e={559:(e,t,o)=>{var n=o(201);window.onload=function(){console.log("window.onload called"),n.T()}},201:(e,t,o)=>{var n,r,i,a,l,c,u;o.d(t,{T:()=>Q});var s=Object.freeze({gain:.5,numSamples:256}),h=(new Uint8Array(s.numSamples/2),function(e){r.src=e});function f(e){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,p(n.key),n)}}function m(e,t,o){return t&&y(e.prototype,t),o&&y(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e}function p(e){var t=function(e){if("object"!=f(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var o=t.call(e,"string");if("object"!=f(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==f(t)?t:t+""}function v(e,t,o){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,o)}function g(e,t){return e.get(w(e,t))}function b(e,t,o){return e.set(w(e,t),o),o}function w(e,t,o){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:o;throw new TypeError("Private element is not present on this object")}function T(e,t){var o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!o){if(Array.isArray(e)||(o=function(e,t){if(e){if("string"==typeof e)return S(e,t);var o={}.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?S(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){o&&(e=o);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,l=!1;return{s:function(){o=o.call(e)},n:function(){var e=o.next();return a=e.done,e},e:function(e){l=!0,i=e},f:function(){try{a||null==o.return||o.return()}finally{if(l)throw i}}}}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,n=Array(t);o<t;o++)n[o]=e[o];return n}var q,x,k,A,L,M,P,F,R,C,E,j,V,D=function(e,t,o,n,r,i){var a,l=e.createLinearGradient(t,o,n,r),c=T(i);try{for(c.s();!(a=c.n()).done;){var u=a.value;l.addColorStop(u.percent,u.color)}}catch(e){c.e(e)}finally{c.f()}return l},W=function(e,t,o,n,r,i,a,l){var c,u=e.createRadialGradient(t,o,n,r,i,a),s=T(l);try{for(s.s();!(c=s.n()).done;){var h=c.value;u.addColorStop(h.percent,h.color)}}catch(e){s.e(e)}finally{s.f()}return u},z=new WeakMap,O=function(){return m((function e(t,o,n,r,i,a,l,c){d(this,e),v(this,z,0),this.ctx=t,this.topLeftX=o,this.topLeftY=n,this.bottomLeftX=r,this.bottomLeftY=i,this.shortWidth=a,this.wideWidth=l,this.audioData=c}),[{key:"update",value:function(){b(z,this,0);for(var e=0;e<this.audioData.length;e++)b(z,this,g(z,this)+this.audioData[e]/255);b(z,this,g(z,this)/this.audioData.length)}},{key:"draw",value:function(){this.ctx.save(),this.ctx.fillStyle="gray",this.ctx.translate(0,40*-g(z,this)),this.ctx.beginPath(),this.ctx.moveTo(this.topLeftX,this.topLeftY),this.ctx.lineTo(this.topLeftX+this.shortWidth,this.topLeftY),this.ctx.lineTo(this.bottomLeftX+this.wideWidth,this.bottomLeftY),this.ctx.lineTo(this.bottomLeftX,this.bottomLeftY),this.ctx.fill(),this.ctx.closePath(),this.ctx.restore()}}])}(),X=new WeakMap,G=new WeakMap,Y=new WeakMap,B=new WeakMap,I=new WeakMap,H=function(){return m((function e(t,o,n,r,i){d(this,e),v(this,X,null),v(this,G,[{percent:0,color:"red"},{percent:1,color:"black"}]),v(this,Y,0),v(this,B,0),v(this,I,0),this.ctx=t,this.x=o,this.y=n,this.radius=r,this.audioData=i}),[{key:"update",value:function(e,t,o){b(Y,this,e),b(B,this,t),b(I,this,o);for(var n=0,r=1,i=0;i<this.audioData.length;i++)n+=this.audioData[i]/255;n/=this.audioData.length,r-=n*=.75,b(G,this,[{percent:0,color:"rgba(".concat(g(Y,this),",").concat(g(B,this),",").concat(g(I,this),",").concat(r,")")},{percent:1,color:"black"}]),b(X,this,W(this.ctx,this.x,this.y+20,5,this.x,this.y,this.radius,g(G,this)))}},{key:"draw",value:function(){this.ctx.save(),this.ctx.fillStyle=g(X,this),this.ctx.beginPath(),this.ctx.arc(this.x,this.y,this.radius,0,2*Math.PI),this.ctx.fill(),this.ctx.closePath()}}])}(),N=255,U=255,$=255,J={showGradient:!1,showBars:!0,showCircles:!1,showNoise:!1,showInvert:!1,showEmboss:!1,byteFreq:!0,mouthType:"mouth1",voiceType:"voice2"},K={};j=function(e){K.sound1=e.audio[1].path,K.sound2=e.audio[1].path,K.sound3=e.audio[1].path,document.title=e.title,document.querySelector("#title").innerHTML=e.title,document.querySelector("#volume-slider").value=e["default-values"].volume,document.querySelector("#volume-label").innerHTML=Math.round(e["default-values"].volume/2*100);var t=document.querySelector("#volume-slider"),o=document.querySelector("#volume-label");for(var n in t.oninput=function(e){var t;t=e.target.value,t=Number(t),l.gain.value=t,o.innerHTML=Math.round(e.target.value/2*100)},e.audio)K["sound"+n]=e.audio[n].path;console.log(K)},(V=new XMLHttpRequest).open("GET","../data/av-data.json",!0),V.onload=function(){if(200===V.status){var e=JSON.parse(V.responseText);j(e)}else console.error("Error reading the shape data")},V.onerror=function(){console.error("Request failed")},V.send();var Q=function(){var e,t,o;console.log("init called"),console.log("Testing utils.getRandomColor() import: ".concat("rgba(".concat((o=function(){return 185*Math.random()+35})(),",").concat(o(),",").concat(o(),",1)"))),e=K.sound1,t=window.AudioContext||window.webkitAudioContext,n=new t,r=new Audio,h(e),i=n.createMediaElementSource(r),(c=n.createBiquadFilter()).type="highshelf",(u=n.createBiquadFilter()).type="lowshelf",(a=n.createAnalyser()).fftSize=s.numSamples,(l=n.createGain()).gain.value=s.gain,i.connect(c),c.connect(u),u.connect(a),a.connect(l),l.connect(n.destination);var f=document.querySelector("canvas");Z(f),function(e,t){q=e.getContext("2d"),x=e.width,k=e.height,console.log(x+", "+k),A=D(q,0,0,0,k,[{percent:0,color:"blue"},{percent:.25,color:"purple"},{percent:.5,color:"black"},{percent:.75,color:"purple"},{percent:1,color:"blue"}]),P=D(q,x/2,0,x/2,k,[{percent:1,color:"gray"},{percent:0,color:"skyblue"}]),W(q,x/2+80,k/2-60,5,x/2+80,k/2-80,40,[{percent:0,color:"red"},{percent:1,color:"black"}]),L=t,M=new Uint8Array(L.fftSize/2),C=new O(q,280,80,260,120,80,120,M),E=new O(q,440,80,420,120,80,120,M);var o=document.querySelector("#color-label-r");document.querySelector("#eye-color-r").oninput=function(e){N=e.target.value,console.log(N+", "+U+", "+$),o.innerText=N};var n=document.querySelector("#color-label-g");document.querySelector("#eye-color-g").oninput=function(e){U=e.target.value,console.log(N+", "+U+", "+$),n.innerText=U};var r=document.querySelector("#color-label-b");document.querySelector("#eye-color-b").oninput=function(e){$=e.target.value,console.log(N+", "+U+", "+$),r.innerText=$},F=new H(q,x/2-80,k/2-80,40,M),R=new H(q,x/2+80,k/2-80,40,M)}(f,a),_()},Z=function(e){document.querySelector("#fs-btn").onclick=function(t){var o;console.log("goFullscreen() called"),(o=e).requestFullscreen?o.requestFullscreen():o.mozRequestFullscreen?o.mozRequestFullscreen():o.mozRequestFullScreen?o.mozRequestFullScreen():o.webkitRequestFullscreen&&o.webkitRequestFullscreen()};var t=document.querySelector("#play-btn");t.onclick=function(e){console.log("audioCtx.state before = $(audio.audioCtx.state)"),"suspended"==n.state&&n.resume(),console.log("audioCtx.state after = $(audio.audioCtx.state)"),"no"==e.target.dataset.playing?(r.play(),e.target.dataset.playing="yes"):(r.pause(),e.target.dataset.playing="no"),document.querySelector("#volume-slider").dispatchEvent(new Event("input")),document.querySelector("#track-select").onchange=function(e){h(e.target.value),(t.dataset.playing="yes")&&t.dispatchEvent(new MouseEvent("click"))}},document.querySelector("#byte-freq").onchange=function(e){J.byteFreq=e.target.checked},document.querySelector("#mouth-select").onchange=function(e){J.mouthType=e.target.value},document.querySelector("#voice-select").onchange=function(e){switch(J.voiceType=e.target.value,console.log(J.voiceType),J.voiceType){case"voice1":ee(!1),te(!0);break;case"voice2":te(!1),ee(!1);break;case"voice3":te(!1),ee(!0)}}},_=function(){setTimeout(_,1e3/60),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e.byteFreq?L.getByteFrequencyData(M):L.getByteTimeDomainData(M),q.save(),q.fillStyle="black",q.globalAlpha=.1,q.fillRect(0,0,x,k),q.restore(),q.save(),q.fillStyle=P,q.beginPath(),q.roundRect(x/4,10,x/2,k-20,50),q.fill(),q.closePath(),q.restore(),F.update(N,U,$),F.draw(),R.update(N,U,$),R.draw(),C.update(),C.draw(),E.update(),E.draw(),e.showGradient&&(q.save(),q.fillStyle=A,q.globalAlpha=.3,q.fillRect(0,0,x,k),q.restore()),"mouth1"==e.mouthType){q.save(),q.fillStyle="red";for(var t=10;t<M.length+10;t++)q.fillRect(x/2-1*(t-10),300-M[t]/255*70,1,2*M[t]/255*70),q.fillRect(x/2+1*(t-10),300-M[t]/255*70,1,2*M[t]/255*70);q.restore()}else if("mouth2"==e.mouthType){q.save(),q.strokeStyle="purple",q.lineWidth=1,q.beginPath(),q.moveTo(400-M.length,300);for(var o=0;o<M.length;o+=3)console.log(M[M.length-o]),o%2==0?q.lineTo(400-M.length+o,300-30*M[M.length-o]/255):q.lineTo(400-M.length+o,300+30*M[M.length-o]/255);for(var n=0;n<M.length;n+=3)n%2==0?q.lineTo(400+n,300-30*M[n]/255):q.lineTo(400+n,300+30*M[n]/255);q.lineTo(400+M.length,300),q.lineTo(400-M.length,300),q.stroke(),q.closePath(),q.restore()}}(J)},ee=function(e){e?(console.log("highshelf on"),c.frequency.setValueAtTime(1e3,n.currentTime),c.gain.setValueAtTime(10,n.currentTime),u.frequency.setValueAtTime(1e3,n.currentTime),u.gain.setValueAtTime(-20,n.currentTime)):(console.log("highshelf off"),c.gain.setValueAtTime(0,n.currentTime),u.gain.setValueAtTime(0,n.currentTime))},te=function(e){e?(console.log("lowshelf on"),c.frequency.setValueAtTime(1e3,n.currentTime),c.gain.setValueAtTime(-20,n.currentTime),u.frequency.setValueAtTime(1e3,n.currentTime),u.gain.setValueAtTime(10,n.currentTime)):(console.log("lowshelf off"),c.gain.setValueAtTime(0,n.currentTime),u.gain.setValueAtTime(0,n.currentTime))}}},t={};function o(n){var r=t[n];if(void 0!==r)return r.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,o),i.exports}o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o(201),o(559)})();