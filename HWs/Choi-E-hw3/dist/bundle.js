(()=>{"use strict";let e,t,o,l,r,i,n;const s=Object.freeze({gain:.5,numSamples:256});new Uint8Array(s.numSamples/2);const a=e=>{t.src=e},c=(e,t,o,l,r,i)=>{let n=e.createLinearGradient(t,o,l,r);for(let e of i)n.addColorStop(e.percent,e.color);return n},u=(e,t,o,l,r,i,n,s)=>{let a=e.createRadialGradient(t,o,l,r,i,n);for(let e of s)a.addColorStop(e.percent,e.color);return a};class h{#e=null;#t=[{percent:0,color:"red"},{percent:1,color:"black"}];#o=0;#l=0;#r=0;constructor(e,t,o,l,r){this.ctx=e,this.x=t,this.y=o,this.radius=l,this.audioData=r}update(e,t,o){this.#o=e,this.#l=t,this.#r=o;let l=0,r=1;for(let e=0;e<this.audioData.length;e++)l+=this.audioData[e]/255;l/=this.audioData.length,l*=.75,r-=l,this.#t=[{percent:0,color:`rgba(${this.#o},${this.#l},${this.#r},${r})`},{percent:1,color:"black"}],this.#e=u(this.ctx,this.x,this.y+20,5,this.x,this.y,this.radius,this.#t)}draw(){this.ctx.save(),this.ctx.fillStyle=this.#e,this.ctx.beginPath(),this.ctx.arc(this.x,this.y,this.radius,0,2*Math.PI),this.ctx.fill(),this.ctx.closePath()}}class d{#i=0;constructor(e,t,o,l,r,i,n,s){this.ctx=e,this.topLeftX=t,this.topLeftY=o,this.bottomLeftX=l,this.bottomLeftY=r,this.shortWidth=i,this.wideWidth=n,this.audioData=s}update(){this.#i=0;for(let e=0;e<this.audioData.length;e++)this.#i+=this.audioData[e]/255;this.#i/=this.audioData.length}draw(){this.ctx.save(),this.ctx.fillStyle="gray",this.ctx.translate(0,40*-this.#i),this.ctx.beginPath(),this.ctx.moveTo(this.topLeftX,this.topLeftY),this.ctx.lineTo(this.topLeftX+this.shortWidth,this.topLeftY),this.ctx.lineTo(this.bottomLeftX+this.wideWidth,this.bottomLeftY),this.ctx.lineTo(this.bottomLeftX,this.bottomLeftY),this.ctx.fill(),this.ctx.closePath(),this.ctx.restore()}}let g,m,p,y,f,T,v,b,q,w,S,x,k=255,A=255,L=255;const F={showGradient:!1,showBars:!0,showCircles:!1,showNoise:!1,showInvert:!1,showEmboss:!1,byteFreq:!0,mouthType:"mouth1",voiceType:"voice2"},R={};(()=>{const e=new XMLHttpRequest;e.open("GET","../data/av-data.json",!0),e.onload=()=>{if(200===e.status){(e=>{R.sound1=e.audio[1].path,R.sound2=e.audio[1].path,R.sound3=e.audio[1].path,document.title=e.title,document.querySelector("#title").innerHTML=e.title,document.querySelector("#volume-slider").value=e["default-values"].volume,document.querySelector("#volume-label").innerHTML=Math.round(e["default-values"].volume/2*100);let t=document.querySelector("#volume-slider"),o=document.querySelector("#volume-label");t.oninput=e=>{var t;t=e.target.value,t=Number(t),r.gain.value=t,o.innerHTML=Math.round(e.target.value/2*100)};for(let t in e.audio)R["sound"+t]=e.audio[t].path;console.log(R)})(JSON.parse(e.responseText))}else console.error("Error reading the shape data")},e.onerror=()=>{console.error("Request failed")},e.send()})();const V=()=>{console.log("init called"),console.log(`Testing utils.getRandomColor() import: ${(()=>{const e=()=>185*Math.random()+35;return`rgba(${e()},${e()},${e()},1)`})()}`),(c=>{const u=window.AudioContext||window.webkitAudioContext;e=new u,t=new Audio,a(c),o=e.createMediaElementSource(t),i=e.createBiquadFilter(),i.type="highshelf",n=e.createBiquadFilter(),n.type="lowshelf",l=e.createAnalyser(),l.fftSize=s.numSamples,r=e.createGain(),r.gain.value=s.gain,o.connect(i),i.connect(n),n.connect(l),l.connect(r),r.connect(e.destination)})(R.sound1);let F=document.querySelector("canvas");C(F),((e,t)=>{g=e.getContext("2d"),m=e.width,p=e.height,console.log(m+", "+p),y=c(g,0,0,0,p,[{percent:0,color:"blue"},{percent:.25,color:"purple"},{percent:.5,color:"black"},{percent:.75,color:"purple"},{percent:1,color:"blue"}]),v=c(g,m/2,0,m/2,p,[{percent:1,color:"gray"},{percent:0,color:"skyblue"}]),x=u(g,m/2+80,p/2-60,5,m/2+80,p/2-80,40,[{percent:0,color:"red"},{percent:1,color:"black"}]),f=t,T=new Uint8Array(f.fftSize/2),w=new d(g,280,80,260,120,80,120,T),S=new d(g,440,80,420,120,80,120,T);let o=document.querySelector("#color-label-r");document.querySelector("#eye-color-r").oninput=e=>{k=e.target.value,console.log(k+", "+A+", "+L),o.innerText=k};let l=document.querySelector("#color-label-g");document.querySelector("#eye-color-g").oninput=e=>{A=e.target.value,console.log(k+", "+A+", "+L),l.innerText=A};let r=document.querySelector("#color-label-b");document.querySelector("#eye-color-b").oninput=e=>{L=e.target.value,console.log(k+", "+A+", "+L),r.innerText=L},b=new h(g,m/2-80,p/2-80,40,T),q=new h(g,m/2+80,p/2-80,40,T)})(F,l),D()},C=o=>{document.querySelector("#fs-btn").onclick=e=>{var t;console.log("goFullscreen() called"),(t=o).requestFullscreen?t.requestFullscreen():t.mozRequestFullscreen?t.mozRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()};const l=document.querySelector("#play-btn");l.onclick=o=>{console.log("audioCtx.state before = $(audio.audioCtx.state)"),"suspended"==e.state&&e.resume(),console.log("audioCtx.state after = $(audio.audioCtx.state)"),"no"==o.target.dataset.playing?(t.play(),o.target.dataset.playing="yes"):(t.pause(),o.target.dataset.playing="no"),document.querySelector("#volume-slider").dispatchEvent(new Event("input")),document.querySelector("#track-select").onchange=e=>{a(e.target.value),(l.dataset.playing="yes")&&l.dispatchEvent(new MouseEvent("click"))}},document.querySelector("#byte-freq").onchange=e=>{F.byteFreq=e.target.checked},document.querySelector("#mouth-select").onchange=e=>{F.mouthType=e.target.value},document.querySelector("#voice-select").onchange=e=>{switch(F.voiceType=e.target.value,console.log(F.voiceType),F.voiceType){case"voice1":M(!1),$(!0);break;case"voice2":$(!1),M(!1);break;case"voice3":$(!1),M(!0)}}},D=()=>{setTimeout(D,1e3/60),((e={})=>{if(e.byteFreq?f.getByteFrequencyData(T):f.getByteTimeDomainData(T),g.save(),g.fillStyle="black",g.globalAlpha=.1,g.fillRect(0,0,m,p),g.restore(),g.save(),g.fillStyle=v,g.beginPath(),g.roundRect(m/4,10,m/2,p-20,50),g.fill(),g.closePath(),g.restore(),b.update(k,A,L),b.draw(),q.update(k,A,L),q.draw(),w.update(),w.draw(),S.update(),S.draw(),e.showGradient&&(g.save(),g.fillStyle=y,g.globalAlpha=.3,g.fillRect(0,0,m,p),g.restore()),"mouth1"==e.mouthType){let e=0,t=1,o=70;g.save(),g.fillStyle="red";for(let l=10;l<T.length+10;l++)g.fillRect(m/2-(l-10)*(t+e),300-T[l]/255*o,t,2*T[l]/255*o),g.fillRect(m/2+(l-10)*(t+e),300-T[l]/255*o,t,2*T[l]/255*o);g.restore()}else if("mouth2"==e.mouthType){let e=30;g.save(),g.strokeStyle="purple",g.lineWidth=1,g.beginPath(),g.moveTo(400-T.length,300);for(let t=0;t<T.length;t+=3)console.log(T[T.length-t]),t%2==0?g.lineTo(400-T.length+t,300-T[T.length-t]*e/255):g.lineTo(400-T.length+t,300+T[T.length-t]*e/255);for(let t=0;t<T.length;t+=3)t%2==0?g.lineTo(400+t,300-T[t]*e/255):g.lineTo(400+t,300+T[t]*e/255);g.lineTo(400+T.length,300),g.lineTo(400-T.length,300),g.stroke(),g.closePath(),g.restore()}})(F)},M=t=>{t?(console.log("highshelf on"),i.frequency.setValueAtTime(1e3,e.currentTime),i.gain.setValueAtTime(10,e.currentTime),n.frequency.setValueAtTime(1e3,e.currentTime),n.gain.setValueAtTime(-20,e.currentTime)):(console.log("highshelf off"),i.gain.setValueAtTime(0,e.currentTime),n.gain.setValueAtTime(0,e.currentTime))},$=t=>{t?(console.log("lowshelf on"),i.frequency.setValueAtTime(1e3,e.currentTime),i.gain.setValueAtTime(-20,e.currentTime),n.frequency.setValueAtTime(1e3,e.currentTime),n.gain.setValueAtTime(10,e.currentTime)):(console.log("lowshelf off"),i.gain.setValueAtTime(0,e.currentTime),n.gain.setValueAtTime(0,e.currentTime))};window.onload=()=>{console.log("window.onload called"),V()}})(),(()=>{const e=document.querySelector("#burger"),t=document.querySelector("#nav-links");e.addEventListener("click",(()=>{t.classList.toggle("is-active")}))})();